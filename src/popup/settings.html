<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sparrow Settings</title>
    <link rel="stylesheet" href="../../assets/css/popup.css">
    <link rel="stylesheet" href="../../assets/css/settings.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="settings-page">
    <header>
        <h1>Settings</h1>
        <!-- Removed subtitle text -->
    </header>

    <main>
        <form id="settings-form">
            <!-- API Mode Selection -->
            <div class="form-group">
                <label for="api-mode-select">API Source</label>
                <select id="api-mode-select" class="api-source-dropdown">
                    <option value="openai">OpenAI</option>
                    <option value="openrouter">OpenRouter</option>
                    <option value="lmstudio">LM Studio</option>
                    <option value="ollama">Ollama</option>
                </select>
            </div>

            <!-- API Sections Container -->
            <div class="api-sections-container">
                <!-- OpenAI API Section -->
                <div id="openai-section" class="api-section">
                    <div class="api-section-title">OpenAI Settings</div>
                    <div class="form-group">
                        <label for="openai-api-key">API Key</label>
                        <input type="password" id="openai-api-key" placeholder="Enter your OpenAI API key">
                        <small>Your API key is stored locally on your device.</small>
                    </div>
                    <div class="form-group">
                        <label for="openai-model">Model</label>
                        <select id="openai-model">
                            <option value="gpt-4o">GPT-4o</option>
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                            <option value="gpt-4">GPT-4</option>
                            <option value="gpt-4-turbo">GPT-4 Turbo</option>
                        </select>
                    </div>
                </div>

                <!-- OpenRouter API Section -->
                <div id="openrouter-section" class="api-section hidden">
                    <div class="api-section-title">OpenRouter Settings</div>
                    <div class="form-group">
                        <label for="openrouter-api-key">API Key</label>
                        <input type="password" id="openrouter-api-key" placeholder="Enter your OpenRouter API key">
                        <small>Your API key is stored locally on your device.</small>
                    </div>
                    <div class="form-group">
                        <label for="openrouter-model">Model</label>
                        <div class="select-with-spinner">
                            <select id="openrouter-model">
                                <option value="">Loading models...</option>
                            </select>
                            <div id="openrouter-spinner" class="spinner hidden">
                                <i class="fa-solid fa-circle-notch fa-spin"></i>
                            </div>
                            <button id="openrouter-refresh" class="refresh-button" title="Refresh models">
                                <i class="fa-solid fa-refresh"></i>
                            </button>
                        </div>
                        <small id="openrouter-model-message">Models will load when a valid API key is provided.</small>
                    </div>
                </div>

                <!-- LM Studio Section -->
                <div id="lmstudio-section" class="api-section hidden">
                    <div class="api-section-title">LM Studio Settings</div>
                    <div class="form-group">
                        <label for="lmstudio-api-url">Server URL</label>
                        <div class="input-with-button">
                            <input type="url" id="lmstudio-api-url" placeholder="http://localhost:1234/v1" value="http://localhost:1234/v1">
                            <button type="button" id="lmstudio-refresh-btn" class="refresh-btn" title="Refresh Models">
                                <i class="fa-solid fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="lmstudio-api-key">API Key (Optional)</label>
                        <input type="password" id="lmstudio-api-key" placeholder="Usually not required for local LM Studio">
                    </div>
                    <div class="form-group">
                        <label for="lmstudio-model">Model</label>
                        <div class="select-with-spinner">
                            <select id="lmstudio-model">
                                <option value="">Loading models...</option>
                            </select>
                            <div id="lmstudio-spinner" class="spinner hidden">
                                <i class="fa-solid fa-circle-notch fa-spin"></i>
                            </div>
                        </div>
                        <small id="lmstudio-model-message">Models will load when a valid server URL is provided.</small>
                    </div>
                </div>

                <!-- Ollama Section -->
                <div id="ollama-section" class="api-section hidden">
                    <div class="api-section-title">Ollama Settings</div>
                    <div class="form-group">
                        <label for="ollama-api-url">Server URL</label>
                        <div class="input-with-button">
                            <input type="url" id="ollama-api-url" placeholder="http://localhost:11434/api" value="http://localhost:11434/api">
                            <button type="button" id="ollama-refresh-btn" class="refresh-btn" title="Refresh Models">
                                <i class="fa-solid fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="ollama-model">Model</label>
                        <div class="select-with-spinner">
                            <select id="ollama-model">
                                <option value="">Loading models...</option>
                            </select>
                            <div id="ollama-spinner" class="spinner hidden">
                                <i class="fa-solid fa-circle-notch fa-spin"></i>
                            </div>
                        </div>
                        <small id="ollama-model-message">Models will load when a valid server URL is provided.</small>
                    </div>
                </div>
            </div>

            <!-- Shared Settings -->
            <div class="form-group">
                <label for="default-format">Default Summary Format</label>
                <select id="default-format">
                    <option value="short">Short Summary</option>
                    <option value="detailed">Detailed Summary</option>
                    <option value="key-points">Key Takeaways</option>
                </select>
            </div>
        </form>

        <div id="message" class="message hidden"></div>

        <div class="actions">
            <button type="button" id="cancel-btn">Cancel</button>
            <button type="submit" id="save-btn" class="primary-btn">Save</button>
        </div>
    </main>

    <script src="settings.js"></script>
</body>
</html>